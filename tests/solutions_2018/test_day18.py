from solutions_2018 import day18 as tscr
import pytest
import numpy as np
import logging as lg

lg.getLogger().setLevel(lg.DEBUG)


def test_lca():
    data_str = "\n".join((
        ".#.#...|#.",
        ".....#|##|",
        ".|..|...#.",
        "..|#.....#",
        "#.#|||#|#|",
        "...#.||...",
        ".|....|...",
        "||...#|.#|",
        "|.||||..|.",
        "...#.|..|."))
    exp_acres = np.array([
        [1, 3, 1, 3, 1, 1, 1, 2, 3, 1],
        [1, 1, 1, 1, 1, 3, 2, 3, 3, 2],
        [1, 2, 1, 1, 2, 1, 1, 1, 3, 1],
        [1, 1, 2, 3, 1, 1, 1, 1, 1, 3],
        [3, 1, 3, 2, 2, 2, 3, 2, 3, 2],
        [1, 1, 1, 3, 1, 2, 2, 1, 1, 1],
        [1, 2, 1, 1, 1, 1, 2, 1, 1, 1],
        [2, 2, 1, 1, 1, 3, 2, 1, 3, 2],
        [2, 1, 2, 2, 2, 2, 1, 1, 2, 1],
        [1, 1, 1, 3, 1, 2, 1, 1, 2, 1]])
    lca = tscr.LCA.from_data_str(data_str)
    np.testing.assert_array_equal(lca.acres, exp_acres)
    assert lca.format_acres() == data_str


example_state_minute_1 = "\n".join((
    ".......##.",
    "......|###",
    ".|..|...#.",
    "..|#||...#",
    "..##||.|#|",
    "...#||||..",
    "||...|||..",
    "|||||.||.|",
    "||||||||||",
    "....||..|."))
example_state_minute_2 = "\n".join((
    ".......#..",
    "......|#..",
    ".|.|||....",
    "..##|||..#",
    "..###|||#|",
    "...#|||||.",
    "|||||||||.",
    "||||||||||",
    "||||||||||",
    ".|||||||||"))
example_state_minute_3 = "\n".join((
    ".......#..",
    "....|||#..",
    ".|.||||...",
    "..###|||.#",
    "...##|||#|",
    ".||##|||||",
    "||||||||||",
    "||||||||||",
    "||||||||||",
    "||||||||||"))
example_state_minute_4 = "\n".join((
    ".....|.#..",
    "...||||#..",
    ".|.#||||..",
    "..###||||#",
    "...###||#|",
    "|||##|||||",
    "||||||||||",
    "||||||||||",
    "||||||||||",
    "||||||||||"))
example_state_minute_5 = "\n".join((
    "....|||#..",
    "...||||#..",
    ".|.##||||.",
    "..####|||#",
    ".|.###||#|",
    "|||###||||",
    "||||||||||",
    "||||||||||",
    "||||||||||",
    "||||||||||"))
example_state_minute_6 = "\n".join((
    "...||||#..",
    "...||||#..",
    ".|.###|||.",
    "..#.##|||#",
    "|||#.##|#|",
    "|||###||||",
    "||||#|||||",
    "||||||||||",
    "||||||||||",
    "||||||||||"))
example_state_minute_7 = "\n".join((
    "...||||#..",
    "..||#|##..",
    ".|.####||.",
    "||#..##||#",
    "||##.##|#|",
    "|||####|||",
    "|||###||||",
    "||||||||||",
    "||||||||||",
    "||||||||||"))
example_state_minute_8 = "\n".join((
    "..||||##..",
    "..|#####..",
    "|||#####|.",
    "||#...##|#",
    "||##..###|",
    "||##.###||",
    "|||####|||",
    "||||#|||||",
    "||||||||||",
    "||||||||||"))
example_state_minute_9 = "\n".join((
    "..||###...",
    ".||#####..",
    "||##...##.",
    "||#....###",
    "|##....##|",
    "||##..###|",
    "||######||",
    "|||###||||",
    "||||||||||",
    "||||||||||"))
example_state_minute_10 = "\n".join((
    ".||##.....",
    "||###.....",
    "||##......",
    "|##.....##",
    "|##.....##",
    "|##....##|",
    "||##.####|",
    "||#####|||",
    "||||#|||||",
    "||||||||||"))


@pytest.mark.parametrize(("n_steps", "exp_state"), [
    (1, example_state_minute_1),
    # (2, example_state_minute_2),
    # (3, example_state_minute_3),
    # (4, example_state_minute_4),
    # (5, example_state_minute_5),
    # (6, example_state_minute_6),
    # (7, example_state_minute_7),
    # (8, example_state_minute_8),
    # (9, example_state_minute_9),
    (10, example_state_minute_10)])
def test_part_1_state(n_steps, exp_state):
    data_str = "\n".join((
        ".#.#...|#.",
        ".....#|##|",
        ".|..|...#.",
        "..|#.....#",
        "#.#|||#|#|",
        "...#.||...",
        ".|....|...",
        "||...#|.#|",
        "|.||||..|.",
        "...#.|..|."))
    lca = tscr.LCA.from_data_str(data_str)
    strange_magic = tscr.StrangeMagic(lca)
    strange_magic.run(n_steps)
    assert strange_magic.lca.format_acres() == exp_state


def test_part_1():
    data_str = "\n".join((
        ".#.#...|#.",
        ".....#|##|",
        ".|..|...#.",
        "..|#.....#",
        "#.#|||#|#|",
        "...#.||...",
        ".|....|...",
        "||...#|.#|",
        "|.||||..|.",
        "...#.|..|."))
    lca = tscr.LCA.from_data_str(data_str)
    strange_magic = tscr.StrangeMagic(lca)
    strange_magic.run(10)
    assert strange_magic.resource_value == 1147
