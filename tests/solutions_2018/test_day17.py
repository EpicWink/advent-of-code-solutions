from solutions_2018 import day17 as tscr
import pytest
import numpy as np
import logging as lg

lg.getLogger().setLevel(lg.DEBUG)


def test_scan():
    data_str = "\n".join((
        "x=495, y=2..7",
        "y=7, x=495..501",
        "x=501, y=3..7",
        "x=498, y=2..4",
        "x=506, y=1..2",
        "x=498, y=10..13",
        "x=504, y=10..13",
        "y=13, x=498..504"))
    exp = "\n".join((
        "..............",
        "............#.",
        ".#..#.......#.",
        ".#..#..#......",
        ".#..#..#......",
        ".#.....#......",
        ".#.....#......",
        ".#######......",
        "..............",
        "..............",
        "....#.....#...",
        "....#.....#...",
        "....#.....#...",
        "....#######..."))
    scan = tscr.Scan.from_data_str(data_str)
    print(scan.format_clay())
    print()
    print(exp)
    assert scan.format_clay() == exp


@pytest.mark.timeout(2.0)
def test_example_water_reach():
    scan = tscr.Scan(np.array([
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
        [0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0],
        [0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0],
        [0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0],
        [0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
        [0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
        [0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0],
        [0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0],
        [0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0],
        [0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0]], dtype=np.bool8), 494)
    simulation = tscr.WaterFlow(scan)
    exp = "\n".join((
        "......+.......",
        "......|.....#.",
        ".#..#||||...#.",
        ".#..#~~#|.....",
        ".#..#~~#|.....",
        ".#~~~~~#|.....",
        ".#~~~~~#|.....",
        ".#######|.....",
        "........|.....",
        "...|||||||||..",
        "...|#~~~~~#|..",
        "...|#~~~~~#|..",
        "...|#~~~~~#|..",
        "...|#######|.."))
    simulation.simulate()
    print(simulation.format_water())
    print()
    print(exp)
    assert simulation.format_water() == exp
